<?php
$host = 'localhost';
$dbname = 'todo_list';
$username = 'root';
$password = '';

try {
  $conn = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
  $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
  die("Database connection failed: " . $e->getMessage());
}
?>
<?php include 'db.php'; ?>

<!DOCTYPE html>
<html>
<head>
  <title>To-Do List</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>My To-Do List</h1>

  <form action="add_task.php" method="POST">
    <input type="text" name="task_name" placeholder="Enter new task" required>
    <button type="submit">Add Task</button>
  </form>

  <ul>
    <?php
    $stmt = $conn->query("SELECT * FROM tasks ORDER BY created_at DESC");
    while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
      echo '<li>';
      echo $row['is_completed'] ? "<s>" . htmlspecialchars($row['task_name']) . "</s>" : htmlspecialchars($row['task_name']);
      echo ' <a href="complete_task.php?id=' . $row['id'] . '">âœ”</a>';
      echo ' <a href="delete_task.php?id=' . $row['id'] . '">ðŸ—‘</a>';
      echo '</li>';
    }
    ?>
  </ul>
</body>
</html>
<?php
include 'db.php';

if (!empty($_POST['task_name'])) {
  $task = $_POST['task_name'];
  $stmt = $conn->prepare("INSERT INTO tasks (task_name) VALUES (:task)");
  $stmt->execute(['task' => $task]);
}

header("Location: index.php");
exit;
?>
<?php
include 'db.php';

if (!empty($_GET['id'])) {
  $id = $_GET['id'];
  $stmt = $conn->prepare("DELETE FROM tasks WHERE id = :id");
  $stmt->execute(['id' => $id]);
}

header("Location: index.php");
exit;
?>
<?php
include 'db.php';

if (!empty($_GET['id'])) {
  $id = $_GET['id'];
  $stmt = $conn->prepare("UPDATE tasks SET is_completed = 1 WHERE id = :id");
  $stmt->execute(['id' => $id]);
}

header("Location: index.php");
exit;
?>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
}

form input {
  padding: 10px;
  margin-right: 5px;
}

form button {
  padding: 10px;
}

ul {
  list-style: none;
  padding-left: 0;
}

li {
  margin: 10px 0;
}
